<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Building Tensorflow from Source on MacOS | Pramod Anantharam</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Building Tensorflow from Source on MacOS" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Tensorflow is the default choice if you are working on Computer Vision projects such as image classfication, object detection, pose estimation, or just any Machine Learning task. I have a MacBook Pro and while using tensorflow, I noticed a warning when importing tensorflow which stated the following." />
<meta property="og:description" content="Tensorflow is the default choice if you are working on Computer Vision projects such as image classfication, object detection, pose estimation, or just any Machine Learning task. I have a MacBook Pro and while using tensorflow, I noticed a warning when importing tensorflow which stated the following." />
<link rel="canonical" href="http://localhost:4000/jekyll/update/2020/05/10/build-tf-from-source-on-mac.html" />
<meta property="og:url" content="http://localhost:4000/jekyll/update/2020/05/10/build-tf-from-source-on-mac.html" />
<meta property="og:site_name" content="Pramod Anantharam" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-10T18:02:41-04:00" />
<script type="application/ld+json">
{"headline":"Building Tensorflow from Source on MacOS","dateModified":"2020-05-10T18:02:41-04:00","datePublished":"2020-05-10T18:02:41-04:00","url":"http://localhost:4000/jekyll/update/2020/05/10/build-tf-from-source-on-mac.html","description":"Tensorflow is the default choice if you are working on Computer Vision projects such as image classfication, object detection, pose estimation, or just any Machine Learning task. I have a MacBook Pro and while using tensorflow, I noticed a warning when importing tensorflow which stated the following.","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/jekyll/update/2020/05/10/build-tf-from-source-on-mac.html"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Pramod Anantharam" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Pramod Anantharam</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/old_home_page/">PhD Life</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Building Tensorflow from Source on MacOS</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-05-10T18:02:41-04:00" itemprop="datePublished">May 10, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Tensorflow is the default choice if you are working on Computer Vision projects such as image classfication, object detection, pose estimation, or just any Machine Learning task. I have a MacBook Pro and while using tensorflow, I noticed a warning when importing tensorflow which stated the following.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2020-05-08 19:57:50.106998: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2020-05-08 19:57:50.128346: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x7febdd364b60 initialized <span class="k">for </span>platform Host <span class="o">(</span>this does not guarantee that XLA will be used<span class="o">)</span><span class="nb">.</span> Devices:
2020-05-08 19:57:50.128370: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device <span class="o">(</span>0<span class="o">)</span>: Host, Default Version
</code></pre></div></div>

<p>This warning is issued because the tensorflow binary installed using <code class="highlighter-rouge">pip install tensorflow</code> was not built specifically built for my machine. Since the binary should work on a wide varity of devices, the tensorflow binary on pip repository would be built such that it works on majority of the hardware. Using this generic binary prevents hardware specific optimizations to be used by tensorflow. These optimizations may lead to gain in performance especially relevant when using only CPU for tensorflow. Since I use CPU-only configuration for tensorflow on my MacBook Pro (I do not have NVIDIA GPUs), this performance gain (upto 300% gain as mentioned <a href="https://stackoverflow.com/questions/47068709/your-cpu-supports-instructions-that-this-tensorflow-binary-was-not-compiled-to-u">here</a>) is very much welcome!</p>

<p>AVX (Advanced Vector Extensions) are instruction set extenstions and specifically, FMA (Fused Multiply Accumulate) introduced by AVX speeds up linear algebra computatsion. For more information, you can read the stakoverflow post <a href="https://stackoverflow.com/questions/47068709/your-cpu-supports-instructions-that-this-tensorflow-binary-was-not-compiled-to-u">here</a>.</p>

<p>Motivated by 300% gain I could get, I strated following instructions for building tensorflow from source using instructions from <a href="https://www.tensorflow.org/install/source">official tensorflow website</a> and <a href="https://stackoverflow.com/questions/41293077/how-to-compile-tensorflow-with-sse4-2-and-avx-instructions?rq=1">stackoverflow post</a>.</p>

<p><strong>Before you build the code, if your MacOS version is &lt; 10.14, I would recommend to upgade it to 10.14 before you proceed</strong>. I lost lot of time since I initially started with 10.13 MacOS version and Python 3.7 version and finally could not install the *.whl file using the pip command (this is the last step which will be outlined later). Note that building tensorflow from source is quite time consuming and memory intensive.</p>

<p>I followed instructions to build tensorflow from source: https://www.tensorflow.org/install/source</p>

<p>Some issues and resolutions that worked for me:</p>
<ul>
  <li>I had to explicity select Xcode using <code class="highlighter-rouge">sudo xcode-select -s /Applications/Xcode.app/Contents/Developer</code> otherwise, I got compile errors when running <code class="highlighter-rouge">bazel build //tensorflow/tools/pip_package:build_pip_package</code></li>
  <li>Having issues as I’m unable to install using <code class="highlighter-rouge">pip install /tmp/tensorflow_pkg/tensorflow-version-tags.whl</code>. I’m getting the following error
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>tf-build<span class="o">)</span> Pramods-MacBook-Pro:tensorflow pramodanantharam<span class="nv">$ </span>pip <span class="nb">install</span> /tmp/tensorflow_pkg/tensorflow-2.2.0-cp37-cp37m-macosx_10_14_x86_64.whl
ERROR: tensorflow-2.2.0-cp37-cp37m-macosx_10_14_x86_64.whl is not a supported wheel on this platform.
</code></pre></div>    </div>
  </li>
  <li>To fix this, I upgraded my MacOS from 10.13 to 10.14 which resolved the issue.</li>
</ul>

<p>Conclusion</p>
<ul>
  <li>Building tensorflow from source is a good idea if you do not have GPU on your machine – if you have a GPU version of tensorflow, you need not bother for this marginal performance gain.</li>
  <li>Having MacOS 10.14.x was necessary for me to complete the process of installing the binary in my virtual environment.</li>
</ul>

  </div><a class="u-url" href="/jekyll/update/2020/05/10/build-tf-from-source-on-mac.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Pramod Anantharam</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Pramod Anantharam</li><li><a class="u-email" href="mailto:pramod [dot] atre [at] gmail [dot] com">pramod [dot] atre [at] gmail [dot] com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/pramodatre"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">pramodatre</span></a></li><li><a href="https://www.linkedin.com/in/pramodprofile"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">pramodprofile</span></a></li><li><a href="https://www.twitter.com/pramodatre"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">pramodatre</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Pramod Anantharam&#39;s website and blog.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
